# 作業ログ - 2025年7月28日 19時01分26秒

## 概要
るんちょまの『教えて下さい、お人間さん』プロジェクトにおいて、運用形態切り替え機能の実装と、それに伴うファイル構成の整理、およびサーバー設定の調整を行った。

## 詳細

### 1. 初期設定とコンテキスト理解
- プロジェクトの初期設定とファイル構成の確認。
- `runchoma-oshiete/docs/` 内の新規MDファイル（データベース設計メモ、語録チェッカー調査、運用ガイドラインドラフト）の内容を確認。

### 2. 管理画面の実装優先決定
- GCPデプロイの前に管理画面の実装を優先する方針を決定。

### 3. ファイル構成の整理とパス修正
- `runchoma-switching-design-draft.md` を修正し、`admin.html` の配置場所を `public/` からルートディレクトリへ変更する設計を反映。
- `express` ライブラリをインストール。
- `server.js` と `admin.html` の雛形を作成。
- `dataManager.js` を `src/data/dataManager.js` へ移動。
- `data.js` を `src/data/localData.js` へリネームして移動。
- `gameCore.js` を `src/core/gameCore.js` へ移動。
- `questionSelector.js` を `src/core/questionSelector.js` へ移動。
- `index.html`, `gameCore.js`, `questionSelector.js`, `dataManager.test.js`, `dataManager.test.mjs` 内のインポートパスを修正。
- `index.html`, `style.css`, `favicon.ico` を `public/` ディレクトリへ移動。

### 4. データソース切り替え機能の実装
- `src/data/spreadsheetClient.js` を作成（ダミー関数を含む）。
- `src/data/dataManager.js` を修正し、環境変数 `DATA_SOURCE` に応じてローカルデータとスプレッドシートデータを切り替えるロジックを実装。
- `gameCore.js` を修正し、`loadItems` 関数（非同期）を使用するように変更。
- `dataManager.js` に `setDataSource` と `getDataSource` 関数を追加し、データソースを動的に設定・取得できるようにした。
- `server.js` を修正し、`dataManager.js` の `setDataSource` と `getDataSource` 関数を呼び出すように変更。
- `admin.html` にスプレッドシートIDとJSON認証情報の入力欄、保存ボタンを追加。
- `server.js` に `setSpreadsheetSettings` API を追加し、スプレッドシート設定を一時的にメモリに保存できるようにした。

### 5. サーバーとクライアント間の連携問題
- `server.js` の静的ファイル提供設定と、クライアント側のJavaScriptファイルのパスの不一致により、`disallowed MIME type ("text/html")` や `404 Not Found` エラーが継続して発生。
- `gameCore.js` 内の `await` キーワード使用箇所で `async` 宣言が不足していた問題を修正。
- `server.js` の静的ファイル提供設定を、`public` と `src` ディレクトリをそれぞれ明示的に静的ファイルとして提供する状態に戻した。
- クライアントサイドのJavaScriptファイルのインポートパスを、サーバーのルートからの絶対パスに修正する試みを行った。
- サーバーサイドのJavaScriptファイルのインポートパスを相対パスに戻した。

## 現在の課題
- JavaScriptモジュールが正しく読み込まれない問題（`disallowed MIME type`、`404 Not Found`）が解決していない。
- ゲーム画面のボタンが反応しない。
- ゲームの文章が古い（データソースの読み込みが正しく行われていない）。

---