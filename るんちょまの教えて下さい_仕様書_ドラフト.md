# るんちょまの『教えて下さい、お人間さん』 - 仕様書ドラフト

## 1. サービス概要
*   **目的:** ユーザーが忘れてしまったモノやサービスを、質問と回答を通じて特定するWebサービス。
*   **着想:** 日常で発生する「あれ、なんだっけ？」という状況を解消し、特に高齢者層のニーズに応える。
*   **コンセプト:** にじさんじ所属のルンルン（あだ名：るんちょま）の二次創作サービスとして展開。ルンルンさんのキャラクター性（出身地不明、性別不明、謎の猛獣（小さくかわいいケモノ）、丁寧な言葉遣い、「お人間さん」という他者と一線を画した態度）をUIやトーンに反映させる。
*   **独自性:** 既存の「20の扉」ゲームとは異なり、ユーザーが忘れたものを特定する目的のサービスは稀であり、高い独自性を持つ。

## 2. コア機能
### 2.1. 質問と回答による特定
*   ユーザーからの「はい」「いいえ」「分からない」の回答に基づいて、対象を絞り込む。
*   「分からない」と回答された場合、その質問の特性では候補を絞り込まない（スコアを変動させない）ロジックとする。

### 2.2. スコアリングと候補提示
*   ユーザーの回答に応じて、データベース内の各モノ・サービスのスコアを変動させる。
    *   回答に合致する特徴を持つモノのスコアを上げ、合致しない特徴を持つモノのスコアを下げる。
*   質問を繰り返し、スコアが3点以上になった候補が5個以下に絞り込まれた場合、リスト形式でユーザーに提示し、「この中にいらっしゃいますか？」と尋ねる。
    *   これにより、質問を延々と続けるよりも効率的かつ視覚的に特定を促す。

### 2.3. 質問の管理と生成
*   **質問の順番:**
    *   ゲーム開始時の最初の質問（モノ、サービス、人物・キャラの選択）を除き、残っている候補の特性を分析し、最も効率的に絞り込める質問をシステムが動的に選択・提示する（エントロピーベースの質問選択ロジックを実装済み）。
*   **質問の生成:**
    *   ユーザーが特定できなかった際に答えを直接入力する際、そのモノの新しい特性情報から、新しいアイテムとしてデータベースに登録する機能を実装済み。これにより、るんちょまの知識が拡充される。

## 3. データ構造
*   **形式:** JSON形式を採用。
*   **内容:** モノやサービスの名前、およびその特徴（characteristics）をキーと値のペアで定義する。
*   **JSON実装例 (セグウェイ):**
    ```json
    {
      "name": "セグウェイ",
      "characteristics": {
        "type": "モノ",
        "category": "乗り物",
        "living": "いいえ",
        "wheels": "はい",
        "power_source": "電気",
        "operation_method": "体重移動",
        "purpose": ["移動", "観光"],
        "other_features": ["立ち乗り", "二輪"]
      }
    }
    ```

## 4. ユーザーインターフェース (UI)
*   **基本デザイン:** プロトタイプ段階ではごくシンプルに、白地を基調とする。
*   **トーン:** ルンルンさんの丁寧な言葉遣いを徹底し、親しみやすく、かつ他者と一線を画した独特の雰囲気を演出する。
*   **UIテキスト例:**
    *   **最初の質問:** 「お人間さん。それはモノですか？　サービスですか？」
    *   **回答ボタン:** 「はい、モノです！」「いいえ、サービスです！」「うーん、どちらか分かりません…」
    *   **一般的な質問:** 「お人間さん。それは乗り物さんですか？」「お人間さん。それは生き物さんですか？」
    *   **回答ボタン:** 「はい、そうです！」「いいえ、違います！」「うーん、分かりません…」
    *   **候補リスト表示時のメッセージ:** 「お人間さん。もしかして、お探しのお品さんは、この中にいらっしゃいますか？」
    *   **候補リスト選択ボタン:** 「はい、この中にいらっしゃいます！」「いいえ、この中にはいらっしゃいません…」
    *   **最終特定結果表示時のメッセージ:** 「お人間さん！るんちょま、見つけましたよ！お探しのお品さんは、『〇〇』ですね、えっへん。」
    *   **最終特定結果確認ボタン:** 「はい、その通りです！」「いいえ、違います…」
*   **「ダークルンルン」モード:**
    *   CSSでダークモードを実装。質問や答えの文章は変わらず、背景色や文字色、ボタンの色などが「ダークルンルン」らしい配色に切り替わる。
    *   二次創作ならではのパロディ要素として実装。

## 5. ユーザーフィードバックとデータベース拡充
### 5.1. ブレイクタイムとデータ収集
*   約10問の質問後、特定に至らなかった場合、一旦ブレイクタイムを設ける。
*   ユーザーに「もしよろしければ、お探しのお品さんのお名前を、るんちょまに教えていただけませんか？」と問いかけ、質問続行か、答えの直接入力かを選択させる。
*   ユーザーが直接答えを入力した場合、その情報（名前と特性）をデータベースに新しいアイテムとして追加、または既存アイテムを更新し、サービスの精度向上に繋げる。

### 5.2. 質問文の報告機能
*   ユーザーが質問文の不適切さ（分かりにくい、誤字脱字など）を報告できる「報告ボタン」を設置。
*   報告ボタンと合わせて短いコメントを入力してもらい、開発者へのフィードバックとして活用する。
*   ユーザーによる質問文の直接編集機能は、将来的な拡張として検討する。

## 6. 技術要件と開発アプローチ
*   **初期アプローチ:** まずはWebサーバーやデータベースなしで、HTML/CSS/JavaScriptのみでフロントエンド完結型でプロトタイプを開発。
    *   データはJavaScriptファイル内に直接持たせる（JSONデータをJSファイル内に埋め込む形）。
    *   GitHub Pagesなどで公開可能。
    *   必要に応じて段階的にバックエンドやデータベースを追加していく。
*   **ファイル数:** 複数のJavaScriptファイル（`main.js`は`gameCore.js`にリファクタリング済み）に分割して開発を進めている。
*   **スパム対策:** 初期プロトタイプでは、データ追加は開発者のみ、または一時的なブラウザ保存に留めることで、スパム対策は後回しにする。

## 7. 未定・要検討事項
*   **UIの詳細デザイン:**
    *   **基本構造:** 画面全体が、水色（空色）の枠線で囲まれた一つのコンテナとなる。
    *   **配置:** 各要素は画面中央に、上から下へ順番に配置する。
        1.  ヘッダー（ロゴ or イラスト）
        2.  メッセージエリア
        3.  選択肢ボタンエリア
        4.  フッター（報告リンク、モード切替）
    *   **配色:**
        *   **通常モード:** 白地 (`#FFFFFF`) を基調とし、枠線やアクセントに爽やかな水色 (`#87CEEB`) を使用。文字は黒または濃いグレー (`#333333`)。
        *   **ダークモード:** 黒や濃いチャコール (`#2c2c2c`) を基調とし、文字は白や薄いグレー (`#f0f0f0`)。アクセントカラーは、るんちょまさんのイメージに合わせて、少し妖しい雰囲気の紫 (`#9370DB`) や青緑 (`#20B2AA`) を採用する。
    *   **フォント:**
        *   **提案:** 全体的に、親しみやすさを出すために丸ゴシック体（例: `M PLUS Rounded 1c`などWebフォントの利用を検討）を採用してはどうか。ロゴは手書き風フォントで作成すると、よりキャラクター性が際立つ。
    *   **各要素の詳細:**
        *   **ヘッダーエリア:** ユーザー（ひろし君）が用意する「るんちょまのイラスト」、または、こちらで作成する手書き風のロゴ「るんちょまの『教えて下さい、お人間さん』」を配置する。**（どちらにするか決定が必要です）**
        *   **メッセージエリア:** るんちょまさんからの質問文が表示されるテキスト表示領域。
        *   **選択肢ボタンエリア:** クイズ・ミリオネアを彷彿とさせる、角の丸いボタンを**2x2のグリッド形式**で配置する。マウスオーバーで少しボタンが浮き上がるようなエフェクトを追加する。
        *   **フッターエリア:**
            *   **報告リンク:** 画面下部の中央、または左下に「問題点を報告する」という小さなテキストリンクを配置する。
            *   **ダークモード切り替えボタン:** 画面右下に、太陽と月のアイコンで切り替えられるボタンを配置する。
*   **スコアリングの閾値:**
    *   **基本方針:** 各数値は、ユーザー体験を損なわず、かつ効率的に特定できるバランスを考慮して設定する。調整可能な設定値として実装する。
    *   **候補リスト提示:** スコアが**3点以上**になった候補が**5個以下**に絞られた場合。
        *   **根拠:** 5個程度であれば、ユーザーが一覧しやすく、選択の負担が少ないため。
    *   **ブレイクタイム挿入:** **10問**回答後。
        *   **根拠:** ユーザーが疲れを感じ始める前に、一区切りを設けるため。一般的な「20の扉」よりも短いスパンで展開することで、テンポの良さを維持する。
    *   **特定不能時の処理:** 10問回答しても候補が5個以下にならない場合、「お人間さん、残念ながら特定できそうにないです…」と表示し、続けて「申し訳ありませんが、答えを教えていただけませんか、お人間さん」と答えの入力を促すダイアログを表示し、データ入力ルーチンに移行する。
*   **初期データセット:**
    *   **方針:** プロトタイプ段階では、多様なカテゴリを網羅し、システムの挙動を確認できる最低限のデータを用意する。
    *   **確定データ:**
        1.  **自動車 (Car)**
        2.  **ボールペン (Ballpoint Pen)**
        3.  **冷蔵庫 (Refrigerator)**
        4.  **カレーライス (Curry Rice)**
        5.  **宅急便 (Home Delivery Service)**
    *   **追加提案データ:** カテゴリのバランスを考慮し、以下の追加を提案します。
        6.  **犬 (Dog)** - `category`: 生き物
        7.  **東京タワー (Tokyo Tower)** - `category`: 場所・建造物
        8.  **クリスマス (Christmas)** - `category`: イベント・概念
        9.  **にじさんじ (NIJISANJI)** - `category`: サービス・ブランド
        10. **スーパーマリオブラザーズ (Super Mario Bros.)** - `category`: ゲーム・作品
*   **エラーハンドリング:**
    *   **ユーザーの高速な操作:** ボタンの連打など、意図しない高速な操作が行われた場合、一時的にボタンを無効化し、処理が完了するまで待機する。
    *   **予期せぬプログラムエラー:** ユーザーには「申し訳ありません、お人間さん。予期せぬ問題が起きてしまいました。ページを再読み込みして、もう一度試していただけますか？」という趣旨の優しいメッセージを表示する。エラーの技術的な詳細はブラウザの開発者ツールコンソールに出力する。
*   **将来的な拡張性（要検討）:**
    *   **多言語対応:**
        *   **優先順位:** まずは日本語版を完成させ、その後、英語対応を検討する。UIテキストとデータセットの翻訳が必要になる。
    *   **ユーザー登録機能:**
        *   **メリット:** 自分が追加したデータを管理できる、他のユーザーのデータ追加履歴が見れる、ランキング機能など。
        *   **デメリット:** 開発コストの増大、個人情報管理の必要性、UIの複雑化。
        *   **結論:** プロトタイプの段階では見送り、サービスの需要が見込めてから本格的に検討する。
    *   **データベース拡充の自動化:**
        *   **構想:** ユーザーが入力した「答え」と、それまでの質問履歴を分析し、新しい「特徴」や「質問」の候補を自動生成する。管理者が承認することで、データベースに反映される半自動システムを目指す。
*   **報告された質問文の処理フロー:**
    *   **UI:** 各質問の近くに、目立ちすぎない「？」や「旗」のようなアイコンで「報告ボタン」を設置する。
    *   **入力フォーム:** 報告ボタンを押すと、Googleフォームが新しいタブで開く。フォームには「質問文」「問題の種類（分かりにくい、誤字など）」「詳細（140字程度）」の入力欄を設ける。
    *   **データ保存:** 送信された内容は、自動的に連携されたGoogleスプレッドシートに保存される。
    *   **処理フロー:** 報告された内容は、開発者であるひろし君が手動で確認し、必要に応じてデータベースに反映する。
*   **モノやサービスの深度（特徴の粒度）:**
    *   **基本方針:** 基本的な特徴（`type`, `category`など）は共通のキーとして定義し、網羅性を高める。
    *   **柔軟性:** 各モノやサービスに固有の、あるいは補足的な特徴は、`other_features`キーに配列（リスト）形式で柔軟に格納する。
    *   **運用方針:** 初期プロトタイプでは、各項目5〜10個程度の特徴から開始し、運用しながらユーザーからのフィードバックを元に、必要に応じて詳細化・拡充していく。